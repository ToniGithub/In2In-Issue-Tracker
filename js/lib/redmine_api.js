redmine={Config:{host:"",useHttpAuth:!1,httpUser:"",httpPassword:"",chiliProject:!1,apiAccessKey:""},callback:function(){},merge:function(a,b){var c={},d;for(d in a)c[d]=a[d];for(d in b)c[d]=b[d];return c}};redmine.Request=function(a){a||(a=redmine.Config);this.config=redmine.merge(redmine.Config,a);this.config.host&&this.config.host.lastIndexOf("/")==this.config.host.length-1&&(this.config.host=this.config.host.substr(0,this.config.host.length-1))};
redmine.Request.prototype.create=function(a,b,c,d){var e=new XMLHttpRequest;"/"!=b[0]&&(b="/"+b);b=this.config.host+b;this.config.useHttpAuth?e.open(a,b,c||!0,this.config.httpUser,this.config.httpPassword):e.open(a,b,c||!0);this.config.chiliProject?e.setRequestHeader("X-ChiliProject-API-Key",this.config.apiAccessKey):e.setRequestHeader("X-Redmine-API-Key",this.config.apiAccessKey);d||e.setRequestHeader("Content-Type","application/json;charset=UTF-8");return e};
redmine.Request.prototype.get=function(a,b){var c=this.create("GET",a);b=b||redmine.callback;c.onload=function(a){if(200==this.status||201==this.status){a={};if(this.response&&""!=this.response)try{a=JSON.parse(this.response)}catch(c){}b(null,a)}else b({error:a,request:this},null)};c.onerror=function(a){b({error:a,request:this},null)};c.send()};
redmine.Request.prototype.post=function(a,b,c){a=this.create("POST",a);b=b||"";c=c||redmine.callback;"string"!=typeof b&&(b=JSON.stringify(b));a.onload=function(a){if(200==this.status||201==this.status){a={};if(this.response&&""!=this.response)try{a=JSON.parse(this.response)}catch(b){}c(null,a)}else c({error:a,request:this},null)};a.onerror=function(a){c({error:a,request:this},null)};a.send(b)};
redmine.Request.prototype.put=function(a,b,c){a=this.create("PUT",a);c=c||redmine.callback;a.onload=function(a){if(200==this.status||201==this.status){a={};if(this.response&&""!=this.response)try{a=JSON.parse(this.response)}catch(b){}c(null,a)}else c({error:a,request:this},null)};a.onerror=function(a){c({error:a,request:this},null)};a.send(b||"")};
redmine.Request.prototype.del=function(a,b){var c=this.create("DELETE",a);b=b||redmine.callback;c.onload=function(a){if(200==this.status||201==this.status){a={};if(this.response&&""!=this.response)try{a=JSON.parse(this.response)}catch(c){}b(null,a)}else b({error:a,request:this},null)};c.onerror=function(a){b({error:a,request:this},null)};c.send()};
redmine.Request.prototype.upload=function(a,b,c){a=this.create("POST",a,!0,!0);a.setRequestHeader("Content-Type","application/octet-stream");c=c||redmine.callback;a.onload=function(a){200==this.status||201==this.status?(a=JSON.parse(this.response),c(null,a)):c({error:a,request:this},null)};a.onerror=function(a){c({error:a,request:this},null)};a.send(b||"")};redmine.Projects=function(a){if(!a||!a instanceof redmine.Request)throw"No redmine.Request passed in.";this.request=a};redmine.Projects.prototype.all=function(a,b){2>arguments.length&&"function"==typeof a&&(b=a,a="");b=b||redmine.callback;this.request.get("/projects.json?"+(a||""),b)};redmine.Projects.prototype.get=function(a,b){if(!a||2>arguments.length)throw Error("No project ID provided");b=b||redmine.callback;this.request.get("/projects/"+a+".json?include=trackers,issue_categories",b)};
redmine.Projects.prototype.create=function(a,b,c,d){if(!a)throw Error("please provide project name");if(!b)throw Error("please provide project identifier");3==arguments.length&&"function"==typeof c&&(d=c,c="");d=d||redmine.callback;this.request.post("/projects.json",JSON.stringify({project:{name:a,identifier:b,description:c||""}}),d)};
redmine.Projects.prototype.update=function(a,b,c){if(3!=arguments.length)throw Error("Please provide project details");if(!a)throw Error("No ID provided.");if(!b||"object"!=typeof b)throw Error("No project provided");c=c||redmine.callback;this.request.put("/projects/"+a+".json",JSON.stringify({project:b}),c)};redmine.Projects.prototype.del=function(a,b){if(!a)throw Error("No ID passed");b=b||redmine.callback;this.request.del("/projects/"+a+".json",b)};
redmine.Projects.prototype.memberships=function(a,b){if(!a)throw Error("No project ID passed");b=b||redmine.callback;this.request.get("/projects/"+a+"/memberships.json",b)};redmine.Issues=function(a){if(!a||!a instanceof redmine.Request)throw Error("No redmine.Request passed in.");this.request=a};redmine.Issues.prototype.all=function(a,b){2>arguments.length&&"function"==typeof a&&(b=a,a="");b=b||redmine.callback;this.request.get("/issues.json?"+(a||""),b)};
redmine.Issues.prototype.get=function(a,b,c){if(!a||2>arguments.length)throw Error("No issue ID passed.");3>arguments.length&&"function"==typeof b&&(c=b,b=!1);c=c||redmine.callback;b=b||!1;this.request.get("/issues/"+a+".json"+(b?"?include="+b:""),c)};redmine.Issues.prototype.comment=function(a,b,c){if(3>arguments.length||!a||!b)throw Error("Please provide all parameters");c=c||redmine.callback;this.request.put("/issues/"+a+".json",{issue:{notes:b}},c)};
redmine.Issues.prototype.create=function(a,b){if(!a)throw Error("No issue details provided");b=b||redmine.callback;this.request.post("/issues.json",JSON.stringify({issue:a}),b)};redmine.Issues.prototype.update=function(a,b,c){if(!a)throw Error("No issue ID provided.");if(!b)throw Error("No issue details provided");c=c||redmine.callback;this.request.put("/issues/"+a+".json",JSON.stringify({issue:b}),c)};
redmine.Issues.prototype.del=function(a,b){if(!a)throw Error("No issue ID provided.");b=b||redmine.callback;this.request.del("/issues/"+a+".json",b)};redmine.Issues.prototype.addWatcher=function(a,b,c){if(!a)throw Error("No issue ID provided.");if(!b)throw Error("No user ID provided");c=c||redmine.callback;this.request.post("/issues/"+a+"/watchers.json",JSON.stringify({user_id:b}),c)};
redmine.Issues.prototype.removeWatcher=function(a,b,c){if(!a)throw Error("No issue ID provided.");if(!b)throw Error("No user ID provided");c=c||redmine.callback;this.request.del("/issues/"+a+"/watchers/"+b+".json",c)};redmine.Issues.prototype.statuses=function(a){a=a||redmine.callback;this.request.get("/issue_statuses.json",a)};redmine.Issues.prototype.priorities=function(a){a=a||redmine.callback;this.request.get("/enumerations/issue_priorities.json",a)};redmine.News=function(a){if(!a||!a instanceof redmine.Request)throw Error("No redmine.Request passed in.");this.request=a};redmine.News.prototype.all=function(a,b){1==arguments.length&&"function"==typeof a&&(b=a,a=!1);b=b||redmine.callback;this.request.get(a?"/projects/"+a+"/news.json":"/news.json",b)};redmine.Users=function(a){if(!a||!a instanceof redmine.Request)throw"No redmine.Request passed in.";this.request=a};redmine.Users.prototype.all=function(a){a=a||redmine.callback;this.request.get("/users.json",a)};redmine.Users.prototype.get=function(a,b,c){if(!a)throw Error("No User ID passed.");3>arguments.length&&"function"==typeof b&&(c=b,b=!1);b=b||!1;c=c||redmine.callback;this.request.get("/users/"+a+".json"+(b?"?include="+b:""),c)};
redmine.Users.prototype.me=function(a,b){2>arguments.length&&"function"==typeof a&&(b=a,a=!1);a=a||!1;b=b||redmine.callback;this.request.get("/users/current.json"+(a?"?include="+a:""),b)};redmine.Users.prototype.create=function(a,b){if(!a||2>arguments.length)throw Error("No user details provided.");b=b||redmine.callback;this.request.post("/users.json",JSON.stringify({user:a}),b)};
redmine.Users.prototype.update=function(a,b,c){if(!a)throw Error("No user id provided.");if(!b||"object"!=typeof b)throw Error("No user details provided.");if(3>arguments.length)throw Error("No user id or details provided.");c=c||redmine.callback;this.request.put("/users/"+a+".json",{user:b},c)};redmine.Users.prototype.del=function(a,b){if(!a||2>arguments.length)throw Error("No user id provided.");b=b||redmine.callback;this.request.del("/users/"+a+".json",b)};redmine.TimeEntries=function(a){if(!a||!a instanceof redmine.Request)throw Error("No redmine.Request passed in.");this.request=a};redmine.TimeEntries.prototype.getActivities=function(a){a=a||redmine.callback;this.request.get("/enumerations/time_entry_activities.json",a)};redmine.TimeEntries.prototype.all=function(a){a=a||redmine.callback;this.request.get("/time_entries.json",a)};
redmine.TimeEntries.prototype.get=function(a,b){if(2>arguments.length||!a)throw Error("Please provide time entry id");b=b||redmine.callback;this.request.get("/time_entries/"+a+".json",b)};redmine.TimeEntries.prototype.create=function(a,b){if(2>arguments.length||!a||"object"!=typeof a)throw Error("Please provide time entry details");this.request.post("/time_entries.json",{time_entry:a},b)};
redmine.TimeEntries.prototype.update=function(a,b,c){if(3>arguments.length||!a||!b||"object"!=typeof b)throw Error("Please provide time entry id and details");this.request.put("/time_entries/"+a+".json",{time_entry:b},c)};redmine.TimeEntries.prototype.del=function(a,b){if(2>arguments.length||!a)throw Error("No time entry ID provided.");this.request.del("/time_entries/"+a+".json",b)};redmine.Api=function(a){this.request=new redmine.Request(a);this.projects=new redmine.Projects(this.request);this.issues=new redmine.Issues(this.request);this.news=new redmine.News(this.request);this.users=new redmine.Users(this.request);this.time_entry=new redmine.TimeEntries(this.request)};redmine.Api.prototype.upload=function(a,b){if(2>arguments.length||!a)throw Error("Please provide all parameters");b=b||redmine.callback;this.request.upload("/uploads.json",a,b)};
